#!/usr/bin/env bash

if [[ "$1" == "-g" ]]; then
  run="valgrind --leak-check=full --show-leak-kinds=all"
  opts=-g
else
  run=""
  # Static libstdc++ shows a memory leak in valgrind.
  # TODO Add exclusion?
  opts="-static-libstdc++"
  # opts="-O3 -flto"
fi

mkdir -p bin || exit
# Use c++11 because it's nice but also old enough it has better support.
time c++ $opts -Wall -Werror -Wpedantic -std=c++11 \
  -o bin/rio src/main.cpp || exit
time $run ./bin/rio -i tests/test1.rio || exit
